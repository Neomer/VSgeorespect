"use strict";function _get(t,e,o){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,o){var n=_superPropBase(t,e);if(n){var r=Object.getOwnPropertyDescriptor(n,e);return r.get?r.get.call(o):r.value}})(t,e,o||t)}function set(t,e,o,n){return(set="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(t,e,o,n){var r,i=_superPropBase(t,e);if(i){if((r=Object.getOwnPropertyDescriptor(i,e)).set)return r.set.call(n,o),!0;if(!r.writable)return!1}if(r=Object.getOwnPropertyDescriptor(n,e)){if(!r.writable)return!1;r.value=o,Object.defineProperty(n,e,r)}else _defineProperty(n,e,o);return!0})(t,e,o,n)}function _set(t,e,o,n,r){if(!set(t,e,o,n||t)&&r)throw new Error("failed to set property");return o}function _defineProperty(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}function _superPropBase(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=_getPrototypeOf(t)););return t}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _possibleConstructorReturn(t,e){return!e||"object"!==_typeof(e)&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function _instanceof(t,e){return null!=e&&"undefined"!=typeof Symbol&&e[Symbol.hasInstance]?!!e[Symbol.hasInstance](t):t instanceof e}function _classCallCheck(t,e){if(!_instanceof(t,e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _createClass(t,e,o){return e&&_defineProperties(t.prototype,e),o&&_defineProperties(t,o),t}var toolbar=null;function isNullOrUndefined(t){return null==t||null==t}var IColor=function(){function t(){_classCallCheck(this,t)}return _createClass(t,[{key:"String",get:function(){throw"IColor.String() - Not implemented!"}},{key:"ToUrl",get:function(){throw"IColor.String() - Not implemented!"}}]),t}(),RGBColor=function(t){function e(){var t;return _classCallCheck(this,e),(t=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this))).color="000000",t}return _inherits(e,IColor),_createClass(e,[{key:"RGB",get:function(){return this.color},set:function(t){if(6!=t.length)throw"Неизвестный формат цвета "+t;this.color=t}},{key:"String",get:function(){return"#"+this.color}},{key:"ToUrl",get:function(){throw"RGBColor.String() - Not implemented!"}}]),e}(),RGBAColor=function(t){function e(){var t;return _classCallCheck(this,e),(t=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this))).alpha="00",t}return _inherits(e,RGBColor),_createClass(e,[{key:"RGBA",get:function(){return this.String},set:function(t){if(6==t.length)_set(_getPrototypeOf(e.prototype),"RGB",t,this,!0),this.alpha="ff";else{if(8!=t.length)throw"Неизвестный формат цвета "+t;this.alpha=t.substring(0,2),_set(_getPrototypeOf(e.prototype),"RGB",t.substring(2),this,!0)}}},{key:"Alpha",get:function(){return this.alpha},set:function(t){this.alpha=t}},{key:"AlphaFloat",get:function(){return parseInt("0x"+this.alpha)/255}},{key:"String",get:function(){return"#"+_get(_getPrototypeOf(e.prototype),"RGB",this)+this.alpha}},{key:"ToUrl",get:function(){throw"RGBAColor.String() - Not implemented!"}}]),e}(),IBrush=function(){function t(){_classCallCheck(this,t)}return _createClass(t,[{key:"getLineColor",value:function(){throw"IBrush.getLineColor() - Not implemented!"}},{key:"getFillColor",value:function(){throw"IBrush.getFillColor() - Not implemented!"}}]),t}(),Brush=function(t){function e(){var t;return _classCallCheck(this,e),(t=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this))).lineColor=new RGBColor,t.fillColor=new RGBAColor,t.weight=1,t}return _inherits(e,IBrush),_createClass(e,[{key:"LineColor",get:function(){return this.lineColor}},{key:"FillColor",get:function(){return this.fillColor}},{key:"Weight",get:function(){return this.weight},set:function(t){this.weight=t}}]),e}(),ICoordinates=function(){function t(){_classCallCheck(this,t)}return _createClass(t,[{key:"String",value:function(){throw"ICoordinates.String() - Not implemented!"}},{key:"fromString",value:function(t){throw"ICoordinates.fromString(data) - Not implemented!"}},{key:"Lat",get:function(){throw"ICoordinates.Lat() - Not implemented!"}},{key:"Lng",get:function(){throw"ICoordinates.Lng() - Not implemented!"}}]),t}(),YandexCoordinates=function(t){function e(t){var o;return _classCallCheck(this,e),(o=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this))).coordinates=t,o}return _inherits(e,ICoordinates),_createClass(e,[{key:"String",value:function(){return this.Lng+","+this.Lat}},{key:"fromString",value:function(t){throw"Not implemented!"}},{key:"Coordinates",get:function(){return this.coordinates}},{key:"Lat",get:function(){return this.coordinates[0]}},{key:"Lng",get:function(){return this.coordinates[1]}}]),e}(),GoogleCoordinates=function(t){function e(t){var o;return _classCallCheck(this,e),(o=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this))).coordinates=t,o}return _inherits(e,ICoordinates),_createClass(e,[{key:"String",value:function(){return this.Lat+","+this.Lng}},{key:"fromString",value:function(t){throw"Not implemented!"}},{key:"Coordinates",get:function(){return this.coordinates}},{key:"Lat",get:function(){return this.coordinates.lat()}},{key:"Lng",get:function(){return this.coordinates.lng()}}]),e}(),IObject=function(){function t(e){if(_classCallCheck(this,t),this.brush=null,Object.is(e,null)||Object.is(e,void 0))throw"Null object!";if("object"!=_typeof(e))throw"Object has wrong type!";this.object=e,this.objectIndex=0}return _createClass(t,[{key:"AddVertex",value:function(t){throw"IObject.AddVertex(coords) - Not implemented!"}},{key:"SetParamaters",value:function(t){throw"IObject.SetParamaters(params) - Not implemented!"}},{key:"SetObjectNumber",value:function(t){this.objectIndex=t}},{key:"Init",value:function(){throw"IObject.Init() - Not implemented!"}},{key:"Draw",value:function(){throw"IObject.Draw() - Not implemented!"}},{key:"Destroy",value:function(){throw"IObject.Destroy() - Not implemented!"}},{key:"Edit",value:function(){throw"IObject.Edit() - Not implemented!"}},{key:"StopEditing",value:function(){throw"IObject.StopEditing() - Not implemented!"}},{key:"ToUrl",value:function(){throw"IObject.ToUrl() - Not implemented!"}},{key:"Brush",set:function(t){this.brush=t},get:function(){return this.brush}},{key:"Object",get:function(){return this.object}},{key:"IsValid",get:function(){throw"IObject.IsValid() - Not implemented!"}},{key:"MaxVerticies",get:function(){throw"IObject.MaxVerticies() - Not implemented!"}},{key:"VerticiesCount",get:function(){throw"IObject.VerticiesCount() - Not implemented!"}},{key:"ObjectNumber",get:function(){return this.objectIndex}}]),t}(),ICompositeObject=function(t){function e(t){var o;return _classCallCheck(this,e),(o=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,t))).coordinates=new Array,o}return _inherits(e,IObject),_createClass(e,[{key:"Coordinates",get:function(){return this.coordinates}},{key:"IsValid",get:function(){this.coordinates.length}}]),e}(),ClosedCompositeObject=function(t){function e(t){return _classCallCheck(this,e),_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,t))}return _inherits(e,ICompositeObject),_createClass(e,[{key:"AddVertex",value:function(t){this.VerticiesCount<this.MaxVerticies?this.coordinates.slice(this.VerticiesCount,0,t):this.coordinates[this.VerticiesCount-1]=t}},{key:"VerticiesCount",get:function(){return 0==this.Coordinates.length?0:this.Coordinates.length+1}}]),e}(),NonClosedCompositeObject=function(t){function e(t){return _classCallCheck(this,e),_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,t))}return _inherits(e,ICompositeObject),_createClass(e,[{key:"AddVertex",value:function(t){this.VerticiesCount<this.MaxVerticies?this.coordinates.push(t):this.coordinates[this.VerticiesCount-1]=t}},{key:"VerticiesCount",get:function(){return this.Coordinates.length}}]),e}(),IPolyline=function(t){function e(t){return _classCallCheck(this,e),_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,t))}return _inherits(e,NonClosedCompositeObject),e}(),Polyline=function(t){function e(t){return _classCallCheck(this,e),_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,t))}return _inherits(e,IPolyline),_createClass(e,[{key:"Draw",value:function(){}},{key:"ToUrl",value:function(){throw"Polyline.ToUrl() - Not implemented!"}},{key:"MaxVerticies",get:function(){return 15}}]),e}(),YandexPolyline=function(t){function e(t){return _classCallCheck(this,e),_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,t))}return _inherits(e,Polyline),_createClass(e,[{key:"Init",value:function(){}},{key:"AddVertex",value:function(t){var o=_get(_getPrototypeOf(e.prototype),"Object",this).geometry;o.insert(o.getLength(),t.Coordinates)}},{key:"Draw",value:function(){_get(_getPrototypeOf(e.prototype),"Object",this).options.set({strokeColor:_get(_getPrototypeOf(e.prototype),"Brush",this).LineColor.String,strokeWidth:_get(_getPrototypeOf(e.prototype),"Brush",this).Weight}),_get(_getPrototypeOf(e.prototype),"Object",this).editor.startEditing()}},{key:"Edit",value:function(){_get(_getPrototypeOf(e.prototype),"Object",this).editor.startEditing()}},{key:"StopEditing",value:function(){_get(_getPrototypeOf(e.prototype),"Object",this).editor.stopEditing()}},{key:"Destroy",value:function(){}},{key:"ToUrl",value:function(){for(var t=_get(_getPrototypeOf(e.prototype),"Object",this).geometry.getCoordinates(),o="",n=0;n<t.length;n++)o+=t[n][1],o+=",",o+=t[n][0],n!==t.length-1&&(o+=",");return"w:"+_get(_getPrototypeOf(e.prototype),"Object",this).options._options.strokeWidth+","+o}}]),e}(),GooglePolyline=function(t){function e(t){return _classCallCheck(this,e),_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,t))}return _inherits(e,Polyline),_createClass(e,[{key:"Init",value:function(){}},{key:"AddVertex",value:function(t){_get(_getPrototypeOf(e.prototype),"Object",this).getPath().push(t.Coordinates)}},{key:"Draw",value:function(){_get(_getPrototypeOf(e.prototype),"Object",this).setOptions({strokeColor:_get(_getPrototypeOf(e.prototype),"Brush",this).LineColor.String,strokeWeight:_get(_getPrototypeOf(e.prototype),"Brush",this).Weight}),_get(_getPrototypeOf(e.prototype),"Object",this).setEditable(!0)}},{key:"Edit",value:function(){_get(_getPrototypeOf(e.prototype),"Object",this).setEditable(!0)}},{key:"StopEditing",value:function(){_get(_getPrototypeOf(e.prototype),"Object",this).setEditable(!1)}},{key:"Destroy",value:function(){_get(_getPrototypeOf(e.prototype),"Object",this).setMap(null)}},{key:"ToUrl",value:function(){throw"Не реализовано GooglePolyline"}}]),e}(),IPolygon=function(t){function e(t){return _classCallCheck(this,e),_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,t))}return _inherits(e,ClosedCompositeObject),e}(),Polygon=function(t){function e(t){return _classCallCheck(this,e),_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,t))}return _inherits(e,IPolygon),_createClass(e,[{key:"Draw",value:function(){}},{key:"ToUrl",value:function(){throw"IPolygon.ToUrl() - Not implemented!"}},{key:"MaxVerticies",get:function(){return 15}}]),e}(),YandexPolygon=function(t){function e(t){return _classCallCheck(this,e),_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,t))}return _inherits(e,Polygon),_createClass(e,[{key:"Init",value:function(){}},{key:"AddVertex",value:function(t){var o=_get(_getPrototypeOf(e.prototype),"Object",this).geometry,n=o.get(0);null!=n&&null!=n||(n=new Array),n.length>0?n.splice(n.length-1,0,t.Coordinates):n.push(t.Coordinates),o.set(0,n)}},{key:"Draw",value:function(){_get(_getPrototypeOf(e.prototype),"Object",this).options.set({strokeColor:_get(_getPrototypeOf(e.prototype),"Brush",this).LineColor.String,strokeWidth:_get(_getPrototypeOf(e.prototype),"Brush",this).Weight,fillColor:_get(_getPrototypeOf(e.prototype),"Brush",this).FillColor.String}),this.Edit()}},{key:"Edit",value:function(){_get(_getPrototypeOf(e.prototype),"Object",this).editor.startEditing()}},{key:"StopEditing",value:function(){_get(_getPrototypeOf(e.prototype),"Object",this).editor.stopEditing()}},{key:"Destroy",value:function(){}},{key:"ToUrl",value:function(){for(var t=_get(_getPrototypeOf(e.prototype),"Object",this).geometry.getCoordinates(),o=_get(_getPrototypeOf(e.prototype),"Object",this).options._options.strokeWidth,n=[],r=0;r<t.length;r++)for(var i=t[r],s=0;s<i.length;s++)n.push(i[s][1]),n.push(i[s][0]);return"c:ec473fFF,f:00FF00A0,w:"+o+","+n.join(",")}}]),e}(),GooglePolygon=function(t){function e(t){return _classCallCheck(this,e),_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,t))}return _inherits(e,Polygon),_createClass(e,[{key:"Init",value:function(){}},{key:"AddVertex",value:function(t){_get(_getPrototypeOf(e.prototype),"Object",this).getPaths().getAt(0).push(t.Coordinates)}},{key:"Draw",value:function(){_get(_getPrototypeOf(e.prototype),"Object",this).setOptions({strokeColor:_get(_getPrototypeOf(e.prototype),"Brush",this).LineColor.String,strokeWeight:_get(_getPrototypeOf(e.prototype),"Brush",this).Weight,fillOpacity:_get(_getPrototypeOf(e.prototype),"Brush",this).FillColor.AlphaFloat,fillColor:_get(_getPrototypeOf(e.prototype),"Brush",this).FillColor.String}),_get(_getPrototypeOf(e.prototype),"Object",this).setEditable(!0)}},{key:"Edit",value:function(){_get(_getPrototypeOf(e.prototype),"Object",this).setEditable(!0)}},{key:"StopEditing",value:function(){_get(_getPrototypeOf(e.prototype),"Object",this).setEditable(!1)}},{key:"Destroy",value:function(){_get(_getPrototypeOf(e.prototype),"Object",this).setMap(null)}}]),e}(),ILine=function(t){function e(t){return _classCallCheck(this,e),_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,t))}return _inherits(e,NonClosedCompositeObject),e}(),Line=function(t){function e(t){return _classCallCheck(this,e),_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,t))}return _inherits(e,ILine),_createClass(e,[{key:"Init",value:function(){}},{key:"ToUrl",value:function(){throw"Не реализовано Line"}},{key:"MaxVerticies",get:function(){return 2}}]),e}(),YandexLine=function(t){function e(t){return _classCallCheck(this,e),_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,t))}return _inherits(e,Line),_createClass(e,[{key:"AddVertex",value:function(t){var o=_get(_getPrototypeOf(e.prototype),"Object",this).geometry;o.getLength()<_get(_getPrototypeOf(e.prototype),"MaxVerticies",this)?o.insert(o.getLength(),t.Coordinates):o.set(o.getLength()-1,t.Coordinates)}},{key:"Draw",value:function(){_get(_getPrototypeOf(e.prototype),"Object",this).options.set({strokeColor:_get(_getPrototypeOf(e.prototype),"Brush",this).LineColor.String,strokeWidth:_get(_getPrototypeOf(e.prototype),"Brush",this).Weight}),_get(_getPrototypeOf(e.prototype),"Object",this).editor.startEditing()}},{key:"Edit",value:function(){_get(_getPrototypeOf(e.prototype),"Object",this).editor.startEditing()}},{key:"StopEditing",value:function(){_get(_getPrototypeOf(e.prototype),"Object",this).editor.stopEditing()}},{key:"Destroy",value:function(){}},{key:"ToUrl",value:function(){for(var t=_get(_getPrototypeOf(e.prototype),"Object",this).geometry.getCoordinates(),o=[],n=0;n<t.length;n++)o.push(t[n][1]),o.push(t[n][0]);var r=_get(_getPrototypeOf(e.prototype),"Object",this).options._options;return"c:"+r.strokeColor.substring(1)+"FF,w:"+r.strokeWidth+","+o.join(",")}}]),e}(),GoogleLine=function(t){function e(t){return _classCallCheck(this,e),_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,t))}return _inherits(e,Line),_createClass(e,[{key:"AddVertex",value:function(t){var o=_get(_getPrototypeOf(e.prototype),"Object",this).getPath();o.length<_get(_getPrototypeOf(e.prototype),"MaxVerticies",this)?o.push(t.Coordinates):o.setAt(o.length-1,t.Coordinates)}},{key:"Draw",value:function(){_get(_getPrototypeOf(e.prototype),"Object",this).setOptions({strokeColor:_get(_getPrototypeOf(e.prototype),"Brush",this).LineColor.String,strokeWeight:_get(_getPrototypeOf(e.prototype),"Brush",this).Weight}),_get(_getPrototypeOf(e.prototype),"Object",this).setEditable(!0)}},{key:"Edit",value:function(){_get(_getPrototypeOf(e.prototype),"Object",this).setEditable(!0)}},{key:"StopEditing",value:function(){_get(_getPrototypeOf(e.prototype),"Object",this).setEditable(!1)}},{key:"Destroy",value:function(){_get(_getPrototypeOf(e.prototype),"Object",this).setMap(null)}},{key:"ToUrl",value:function(){throw"Не реализовано GoogleLine"}}]),e}(),IInfo=function(t){function e(t){var o;return _classCallCheck(this,e),(o=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,t))).coordinates=null,o.text="",o}return _inherits(e,IObject),_createClass(e,[{key:"Coordinates",get:function(){return this.coordinates}},{key:"Text",get:function(){return this.text},set:function(t){this.text=t,this.Draw()}}]),e}(),Info=function(t){function e(t){return _classCallCheck(this,e),_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,t))}return _inherits(e,IInfo),_createClass(e,[{key:"Draw",value:function(){null!=_get(_getPrototypeOf(e.prototype),"Text",this)&&null!=_get(_getPrototypeOf(e.prototype),"Text",this)&&""!=_get(_getPrototypeOf(e.prototype),"Text",this)||($('#infoMessageDialog input[type="text"]').val(""),$("#infoMessageDialog").dialog("open"))}},{key:"AddVertex",value:function(t){this.VerticiesCount<this.MaxVerticies?this.coordinates.push(t):this.coordinates[this.VerticiesCount-1]=t}},{key:"MaxVerticies",get:function(){return null==this.coordinates?0:1}}]),e}(),GoogleInfo=function(t){function e(t){var o;return _classCallCheck(this,e),o=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,t)),t.setContent("test message"),t.open(),o}return _inherits(e,Info),_createClass(e,[{key:"Init",value:function(){}},{key:"AddVertex",value:function(t){_get(_getPrototypeOf(e.prototype),"Object",this).setPosition(t.Coordinates),_get(_getPrototypeOf(e.prototype),"Object",this).setOptions({label:_get(_getPrototypeOf(e.prototype),"ObjectNumber",this).toString()})}},{key:"Draw",value:function(){_get(_getPrototypeOf(e.prototype),"Draw",this).call(this),_get(_getPrototypeOf(e.prototype),"Object",this).setContent(_get(_getPrototypeOf(e.prototype),"Text",this))}},{key:"Edit",value:function(){}},{key:"StopEditing",value:function(){}},{key:"Destroy",value:function(){_get(_getPrototypeOf(e.prototype),"Object",this).setMap(null)}}]),e}(),YandexInfo=function(t){function e(t){return _classCallCheck(this,e),_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,t))}return _inherits(e,Info),_createClass(e,[{key:"Init",value:function(){}},{key:"AddVertex",value:function(t){_get(_getPrototypeOf(e.prototype),"Object",this).geometry.setCoordinates(t.Coordinates)}},{key:"Draw",value:function(){_get(_getPrototypeOf(e.prototype),"Draw",this).call(this),_get(_getPrototypeOf(e.prototype),"Object",this).balloon.setData(_get(_getPrototypeOf(e.prototype),"Text",this)),_get(_getPrototypeOf(e.prototype),"Object",this).balloon.open()}},{key:"Edit",value:function(){}},{key:"StopEditing",value:function(){}},{key:"Destroy",value:function(){}},{key:"ToUrl",value:function(){throw"YandexInfo.ToUrl(type) - Not implemented!"}}]),e}(),IObjectFactory=function(){function t(e){_classCallCheck(this,t),this.map=e}return _createClass(t,[{key:"CreateObject",value:function(t){throw"IObjectFactory.CreateObject(type) - Not implemented!"}},{key:"Map",get:function(){return this.map}}]),t}(),YandexObjectFactory=function(t){function e(t){return _classCallCheck(this,e),_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,t))}return _inherits(e,IObjectFactory),_createClass(e,[{key:"CreateObject",value:function(t){switch(t){case"message":return new YandexInfo(new ymaps.Placemark([]));case"line":return new YandexLine(new ymaps.Polyline([]));case"polyline":return new YandexPolyline(new ymaps.Polyline([]));case"polygon":return new YandexPolygon(new ymaps.Polygon([[]]));default:return null}}}]),e}(),GoogleObjectFactory=function(t){function e(t){var o;return _classCallCheck(this,e),(o=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,t))).objIndexes={},o}return _inherits(e,IObjectFactory),_createClass(e,[{key:"CreateObject",value:function(t){var e=null,o=null==this.objIndexes[t]||null==this.objIndexes[t]?1:this.objIndexes[t]+1;switch(t){case"message":e=new GoogleInfo(new google.maps.InfoWindow);break;case"line":e=new GoogleLine(new google.maps.Polyline);break;case"polyline":e=new GooglePolyline(new google.maps.Polyline);break;case"polygon":e=new GooglePolygon(new google.maps.Polygon);break;default:return null}return null!=e&&null!=e&&(e.SetObjectNumber(o),this.objIndexes[t]=o),e}}]),e}(),IGeoCoder=function(){function t(){_classCallCheck(this,t)}return _createClass(t,[{key:"Find",value:function(t,e){throw"IGeoCoder.Find(address, callback) - Not implemented!"}}]),t}(),GeoCoderResultCollection=function(){function t(){_classCallCheck(this,t),this.array=new Array}return _createClass(t,[{key:"push",value:function(t){this.array.push(t)}},{key:"first",value:function(){return this.array[0]}},{key:"Count",get:function(){return this.array.length}},{key:"AddressList",get:function(){var t=new Array;return this.array.forEach(function(e){t.push(e.Address)}),t}},{key:"AutocompleteData",get:function(){var t=new Array;return this.array.forEach(function(e){t.push({label:e.Address,value:e.Address,longlat:e.Coordinates})}),t}}]),t}(),GeoCoderResult=function(){function t(e,o){_classCallCheck(this,t),this.address=e,this.coordinates=o}return _createClass(t,[{key:"Address",get:function(){return this.address}},{key:"Coordinates",get:function(){return this.coordinates}}]),t}(),GoogleGeoCoder=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,_getPrototypeOf(e).apply(this,arguments))}return _inherits(e,IGeoCoder),_createClass(e,[{key:"Find",value:function(t,e){$.ajax({url:"https://maps.googleapis.com/maps/api/geocode/json?key=AIzaSyDVMh5lFcTxtkxXrL7uXJ6Qd3fSdStbvfs&address="+t,cache:!1}).done(function(t){if("OK"!=t.status)return alert("Не удалось найти указанный адрес!"),null;var o=new GeoCoderResultCollection;t.results.forEach(function(t){console.log(t),o.push(new GeoCoderResult(t.formatted_address,new GoogleCoordinates(t.geometry.location)))}),e(o)}).fail(function(){alert("Не удалось выполнить запрос! Попробуйте позже!")})}}]),e}(),YandexGeoCoder=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,_getPrototypeOf(e).call(this))}return _inherits(e,IGeoCoder),_createClass(e,[{key:"Find",value:function(t,e){var o=ymaps.geocode(t,{json:!0}),n=new GeoCoderResultCollection;o.then(function(t){t.GeoObjectCollection.featureMember.forEach(function(t){n.push(new GeoCoderResult(t.GeoObject.name,new YandexCoordinates(t.GeoObject.Point.pos)))}),console.log(t),e(n)},function(t){console.log(t)})}}]),e}(),IStaticMapUrlBuilder=function(){function t(e){_classCallCheck(this,t),this.basePath=e,this.center=null}return _createClass(t,[{key:"Center",value:function(t){throw"Center(center) not implemented!"}},{key:"AddMarker",value:function(t){throw"AddMarker(marker) not implemented!"}},{key:"AddPath",value:function(t){throw"AddPath(path) not implemented!"}},{key:"Build",value:function(){throw"IStaticMapUrlBuilder.Build() not implemented!"}}]),t}(),BaseStaticMapUrlBuilder=function(t){function e(t){var o;return _classCallCheck(this,e),(o=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,t))).markers=[],o.path=[],o}return _inherits(e,IStaticMapUrlBuilder),_createClass(e,[{key:"Center",value:function(t){return this.center=t,this}},{key:"AddMarker",value:function(t){return this.markers.push(t),this}},{key:"AddPath",value:function(t){return this.path.push(t),this}},{key:"Zoom",value:function(t){return this.zoom=t,this}}]),e}(),YandexStaticUrlBuilder=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,"https://static-maps.yandex.ru/1.x/"))}return _inherits(e,BaseStaticMapUrlBuilder),_createClass(e,[{key:"Build",value:function(){if(isNullOrUndefined(null==this.center))throw"Center is required!";if(isNullOrUndefined(this.zoom))throw"Zoom is required!";return this.basePath+"?l=map&size=300,400&spn=0.0024,0.0024"}},{key:"Getcoordinates",value:function(){var t=this.center,e=t.Lng,o=t.Lat,n=e-.0025489,r=o+.003191,i=e+.003901,s=o+-.0014589;return[[n,r],[i,r],[n,s],[i,s]]}}]),e}(),GoogleStaticUrlBuilder=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,"https://maps.googleapis.com/maps/api/staticmap"))}return _inherits(e,BaseStaticMapUrlBuilder),_createClass(e,[{key:"Build",value:function(){if(isNullOrUndefined(null==this.center))throw"Center is required!";if(isNullOrUndefined(this.zoom))throw"Zoom is required!";return this.basePath+"?size=300x300&maptype=roadmap&key=AIzaSyDVMh5lFcTxtkxXrL7uXJ6Qd3fSdStbvfs&format=PNG&language=ru-RU&center="+this.center.String()+"&zoom="+this.zoom}}]),e}(),IMap=function(){function t(e){_classCallCheck(this,t),this.divName=e,this.divElement=$(e),this.selectedBrush=new Brush,this.selectedObject=null,this.isInit=!1,this.objects=new Array,this.geocoder=null,this.factory=null}return _createClass(t,[{key:"Init",value:function(){this.isInit=!0,this.ActiveBrush.LineColor.RGB="880000",this.ActiveBrush.FillColor.RGB="880000",this.ActiveBrush.FillColor.Alpha="88",this.ActiveBrush.Weight=1}},{key:"Load",value:function(){for(var t=0;t<this.objects.length;t++)this.objects[t].Draw()}},{key:"Unload",value:function(){throw"IMap.Unload() - Not implemented!"}},{key:"SelectObject",value:function(t){this.selectedObject=t,this.objects.forEach(function(t){t.StopEditing()}),null!=t&&null!=t&&t.Edit();var e=this;$(document).on("keyup",function(t){46==t.keyCode?(null!=e.SelectedObject&&null!=e.SelectedObject&&e.SelectedObject.Destroy(),toolbar.flush(),e.EndDrawing()):27==t.keyCode&&(toolbar.flush(),e.EndDrawing())})}},{key:"CreateObject",value:function(t){if(Object.is(t,null)||Object.is(t,void 0))throw"Null reference exception!";t.Init(),this.objects.push(t),this.SelectObject(t),t.Brush=this.selectedBrush}},{key:"BeginDrawing",value:function(t){throw"IMap.BeginDrawing(type) - Not implemented!"}},{key:"EndDrawing",value:function(){this.SelectObject(null)}},{key:"SetZoom",value:function(t){throw"IMap.SetZoom(value) - Not implemented!"}},{key:"SetCenter",value:function(t){throw"IMap.SetCenter(value) - Not implemented!"}},{key:"StaticUrlBuilder",value:function(){throw"IMap.StaticUrlBuilder() - Not implemented!"}},{key:"AddInPDF",value:function(t){throw"IMap.AddInPDF(pdf) - Not implemented!"}},{key:"ActiveBrush",get:function(){return this.selectedBrush}},{key:"ObjectFactory",get:function(){return this.factory}},{key:"MapElement",get:function(){return this.divElement}},{key:"ElementName",get:function(){return this.divName}},{key:"IsInit",get:function(){return this.isInit}},{key:"GeoCoder",get:function(){return this.geocoder}},{key:"SelectedObject",get:function(){return this.selectedObject}}]),t}(),GoogleMap=function(t){function e(t){var o;return _classCallCheck(this,e),(o=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,t))).instance=null,o.clickListener=null,o.staticUrlBuilder=new GoogleStaticUrlBuilder,o}return _inherits(e,IMap),_createClass(e,[{key:"Init",value:function(){_get(_getPrototypeOf(e.prototype),"Init",this).call(this),this.geocoder=new GoogleGeoCoder,this.factory=new GoogleObjectFactory(this,this.instance)}},{key:"Load",value:function(){if(!_get(_getPrototypeOf(e.prototype),"IsInit",this))throw"Карты не были инициализированы!";this.instance=new google.maps.Map(document.getElementById("map"),{zoom:16,center:{lat:56.852379,lng:53.202749},disableDoubleClickZoom:!1,fullscreenControl:!1,scaleControl:!1,rotateControl:!1,styles:[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"transit.station",elementType:"labels",stylers:[{visibility:"off"}]}]}),this.instance.setOptions({draggableCursor:"arrow"}),_get(_getPrototypeOf(e.prototype),"Load",this).call(this)}},{key:"Unload",value:function(){}},{key:"CreateObject",value:function(t){_get(_getPrototypeOf(e.prototype),"CreateObject",this).call(this,t);var o=this,n=this;t.Object.addListener("click",function(e){if(null!=n.SelectedObject&&null!=n.SelectedObject){var r=new GoogleCoordinates(e.latLng);n.SelectedObject.AddVertex(r),n.SelectedObject.Draw()}else o.SelectObject(t)}),t.Object.addListener("rightclick",function(t){n.EndDrawing()})}},{key:"BeginDrawing",value:function(t){this.EndDrawing();var o=this.instance,n=this,r=_get(_getPrototypeOf(e.prototype),"ObjectFactory",this).CreateObject(t);null!=r&&null!=r&&(this.CreateObject(r),r.Object.setMap(o),this.clickListener=o.addListener("click",function(t){var e=new GoogleCoordinates(t.latLng);null!=n.SelectedObject&&null!=n.SelectedObject&&(n.SelectedObject.AddVertex(e),n.SelectedObject.Draw())}),o.addListener("rightclick",function(t){n.EndDrawing()}),o.setOptions({draggableCursor:"crosshair"}))}},{key:"EndDrawing",value:function(){_get(_getPrototypeOf(e.prototype),"EndDrawing",this).call(this),null!=this.clickListener&&null!=this.clickListener&&this.clickListener.remove(),this.instance.setOptions({draggableCursor:"arrow"}),$(document).off("keyup")}},{key:"SetZoom",value:function(t){this.instance.setZoom(parseInt(t))}},{key:"SetCenter",value:function(t){this.instance.setCenter(t.Coordinates)}},{key:"PrepareStaticUrl",value:function(){return this.staticUrlBuilder.Center(new GoogleCoordinates(this.instance.getCenter())).Zoom(this.instance.getZoom()).Build()}},{key:"AddInPDF",value:function(t){toggleGoogleMapElements(),html2canvas(document.getElementById("map"),{useCORS:!0,useOverflow:!1}).then(function(e){toggleGoogleMapElements();var o=e.toDataURL("image/png");t.addImage(o,"PNG",15,15,180,240)})}}]),e}();function toggleGoogleMapElements(){$(".gm-style .gm-style-mtc").toggle(),$(".gm-svpc").toggle(),$(".gmnoprint").toggle(),$(".gm-style .gm-style-iw-c").css("box-shadow","none !important")}var YandexMap=function(t){function e(t){var o;return _classCallCheck(this,e),(o=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,t))).instance=null,o.staticUrlBuilder=new YandexStaticUrlBuilder,o}return _inherits(e,IMap),_createClass(e,[{key:"Init",value:function(){_get(_getPrototypeOf(e.prototype),"Init",this).call(this),this.geocoder=new YandexGeoCoder,this.factory=new YandexObjectFactory(this,this.instance)}},{key:"Load",value:function(){if(!_get(_getPrototypeOf(e.prototype),"IsInit",this))throw"Карты не были инициализированы!";this.instance=new ymaps.Map(this.ElementName,{center:[56.852379,53.202749],zoom:16,minZoom:16,avoidFractionalZoom:!1}),this.cursor=this.instance.cursors.push("arrow"),this.instance.behaviors.disable("scrollZoom").disable("dblClickZoom").disable("rightMouseButtonMagnifier").disable("leftMouseButtonMagnifier").disable("ruler").disable("routeEditor"),this.instance.controls.remove("fullscreenControl").remove("routeEditor").remove("rulerControl").remove("searchControl").remove("trafficControl").remove("zoomControl"),_get(_getPrototypeOf(e.prototype),"Load",this).call(this)}},{key:"Unload",value:function(){null!=this.instance&&null!=this.instance&&this.instance.destroy()}},{key:"SetZoom",value:function(t){this.instance.setZoom(t)}},{key:"SetCenter",value:function(t){this.instance.setCenter(t.Coordinates)}},{key:"CreateObject",value:function(t){_get(_getPrototypeOf(e.prototype),"CreateObject",this).call(this,t),t.Object.events.add("click",function(e){map.SelectObject(t)}),this.instance.geoObjects.add(t.Object)}},{key:"BeginDrawing",value:function(t){this.EndDrawing();var o=this.instance,n=this,r=_get(_getPrototypeOf(e.prototype),"ObjectFactory",this).CreateObject(t);null!=r&&null!=r&&(this.CreateObject(r),o.events.add("click",function(t){var e=new YandexCoordinates(t.get("coords"));n.SelectedObject.AddVertex(e),n.SelectedObject.Draw()}),this.cursor.setKey("crosshair"))}},{key:"EndDrawing",value:function(){_get(_getPrototypeOf(e.prototype),"EndDrawing",this).call(this),this.cursor.setKey("arrow"),this.instance.events.remove("click"),$(document).off("keyup")}},{key:"PrepareStaticUrl",value:function(){return this.staticUrlBuilder.Center(new YandexCoordinates(this.instance.getCenter())).Zoom(this.instance.getZoom()).Build()}},{key:"GetImages",value:function(){for(var t=[],e=this.objects.length,o=0;o<e;o++)t.push(this.objects[o].ToUrl());var n=this.staticUrlBuilder.Center(new YandexCoordinates(this.instance.getCenter())).Zoom(this.instance.getZoom()).Build(),r=this.staticUrlBuilder.Getcoordinates(),i=[];for(o=0;o<r.length;o++){var s=r[o],l=document.createElement("img");l.setAttribute("src",n+"&ll="+s[0]+","+s[1]+(e?"&pl="+t.join("~"):"")),i.push(l)}return i}},{key:"AddImagesToPDF",value:function(t,e){t.addImage(e[0],"PNG",15,15,90,120),t.addImage(e[1],"PNG",105,15,90,120),t.addImage(e[2],"PNG",15,135,90,120),t.addImage(e[3],"PNG",105,135,90,120)}},{key:"AddInPDF",value:function(t){this.AddImagesToPDF(t,this.GetImages())}}]),e}(),MapProvider=function(){function t(){_classCallCheck(this,t),this.maps={},this.active=null}return _createClass(t,[{key:"Add",value:function(t,e){this.maps[t]=e}},{key:"Get",value:function(t){return this.maps[t]}},{key:"Select",value:function(t){var e=this.maps;Object.keys(this.maps).forEach(function(t){e[t].Unload()}),this.active=this.maps[t],this.active.Load()}},{key:"GetAll",value:function(){return Object.values(this.maps)}},{key:"ActiveMap",get:function(){if(null==this.active||null==this.active)throw"Нет активной карты!";return this.active}}]),t}(),mapProvider=new MapProvider;function InitGoogleMap(){mapProvider.Get("google").Init(),mapProvider.Select("google")}function SaveToPDF(){var t=new jsPDF,e=mapProvider.active;e.EndDrawing(),e.AddInPDF(t),setTimeout(function(){t.save("Test.pdf")},500)}mapProvider.Add("yandex",new YandexMap("map")),mapProvider.Add("google",new GoogleMap("map")),$(function(){!function(t){t.fn.toolbar=function(e){var o=t.extend({controls:[],selected:function(t,e){}},e),n=t(this);return this.flush=function(){t(this).find(".toolbar-button-selected").removeClass("toolbar-button-selected")},this.each(function(){n.addClass("toolbar"),o.controls.forEach(function(e){var r=document.createElement("div");null!=e.image&&null!=e.image&&t(r).html('<img src="content/images/'+e.image+'" />'),t(r).html(t(r).html()+" "+e.title),t(r).addClass("toolbar-button"),t(r).attr("command",e.command),null!=e.tooltip&&null!=e.tooltip&&""!=e.tooltip&&t(r).attr("title",e.tooltip),t(r).click(function(e){var n=t(this).parent().find(".toolbar-button-selected").attr("command");t(this).hasClass("toolbar-button-selected")?(t(this).removeClass("toolbar-button-selected"),o.selected(null,n)):(t(this).parent().find(".toolbar-button").removeClass("toolbar-button-selected"),t(this).addClass("toolbar-button-selected"),o.selected(t(this).attr("command"),n))}),n.append(r)})})}}(jQuery),toolbar=$("#toolbar").toolbar({controls:[{title:"Сообщение",command:"message",image:"x16/speech-bubble.png"},{title:"Отрезок",command:"line",image:"x16/line.png",tooltip:"Простая линия"},{title:"Ломанная",command:"polyline",image:"x16/polyline.png",tooltip:"Ломанная линия"},{title:"Полигон",command:"polygon",image:"x16/hexagon.png",tooltip:"Заполненная цветом область"}],selected:function(t,e){null!=t&&null!=t?mapProvider.ActiveMap.BeginDrawing(t):mapProvider.ActiveMap.EndDrawing()}}),$("#service_toolbar").toolbar({controls:[{title:"Яндекс.Карты",command:"yandex",image:"x16/yandex.png"},{title:"Google Maps",command:"google",image:"x16/google.png"}],selected:function(t,e){toolbar.flush(),mapProvider.Select(t)}}),$("#scale_selector").toolbar({controls:[{title:"1:2000",command:17},{title:"1:5000",command:16},{title:"1:10000",command:15}],selected:function(t,e){mapProvider.ActiveMap.SetZoom(t)}}),$("#lineColorPicker").spectrum({flat:!1,showAlpha:!1,showPalette:!0,cancelText:"Отмена",chooseText:"Применить",color:"#880000",maxSelectionSize:4,showButtons:!1,move:function(t){console.log("Color pick: "+t.toHexString().substring(1)),mapProvider.GetAll().forEach(function(e){e.ActiveBrush.LineColor.RGB=t.toHexString().substring(1),null!=e.SelectedObject&&null!=e.SelectedObject&&e.SelectedObject.Draw()})}}),$("#fillColorPicker").spectrum({flat:!1,showAlpha:!0,showPalette:!0,cancelText:"Отмена",chooseText:"Применить",color:"#88880000",maxSelectionSize:4,showButtons:!1,move:function(t){mapProvider.GetAll().forEach(function(e){e.ActiveBrush.FillColor.RGBA=t.toHex8String().substring(1),null!=e.SelectedObject&&null!=e.SelectedObject&&e.SelectedObject.Draw()})}}),$("#lineWeight").on("change",function(t){var e=this.value;mapProvider.GetAll().forEach(function(t){t.ActiveBrush.Weight=e,null!=t.SelectedObject&&null!=t.SelectedObject&&t.SelectedObject.Draw()})});var t=function(t){mapProvider.ActiveMap.SelectedObject.Text=t.val()};$('#infoMessageDialog input[type="text"]').on("keyup",function(e){switch(e.keyCode){case 13:$("#infoMessageDialog").dialog("close");t($(this))}}),$("#infoMessageDialog").dialog({width:"400px",height:"auto",resizable:!1,modal:!0,buttons:{"Применить":function(){$(this).dialog("close"),t($(this).find("input[type=text]"))},"Отмена":function(){$(this).dialog("close")}}}),$("#infoMessageDialog").dialog("close"),$("#btnFindAddress").click(function(){mapProvider.ActiveMap.GeoCoder.Find($("#txtAddress").val(),function(t){null!=t&&null!=t&&t.Count>0&&(mapProvider.ActiveMap.SetCenter(t.first().Coordinates),$("#txtAddress").val(t.first().Address))})})}),ymaps.ready(function(){var t=mapProvider.Get("yandex");null!=t&&null!=t&&t.Init()});